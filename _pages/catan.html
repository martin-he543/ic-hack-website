<!DOCTYPE html>
<html>
  <head>
    <title>Catan Map Generator</title>

    <!-- Meta tags -->
    <meta name="robots" content="index, follow, archive">
    <meta name="description" content="Create randomized 'Settlers of Catan' maps and choose where the best opening placements are.  Share with others, and challenge them to do better!">
    <meta charset="utf-8" />
    <meta http-equiv="Cache-control" content="public">

    <!-- Semantic Markup -->
    <meta property="og:title" content="Catan Board Generator">
    <meta property="og:type" content="website">
    <meta property="og:description" content="Create randomized 'Settlers of Catan' maps and choose where the best opening placements are.  Share with others, and challenge them to do better!">


    <!-- Favicons -->
    <link rel="apple-touch-icon" sizes="180x180" href="/assets/settlers/favicon/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/assets/settlers/favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/assets/settlers/favicon/favicon-16x16.png">
    <link rel="manifest" href="/assets/settlers/favicon/manifest.json">
    <link rel="mask-icon" href="/assets/settlers/favicon/safari-pinned-tab.svg" color="#5bbad5">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css" integrity="sha512-xh6O/CkQoPOWDdYTDqeRdPCVd1SpvCA9XXcUnZS2FmJNp1coAFzvtCN9BmamE+4aHK8yyUHUSCcJHgXloTyT2A==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="shortcut icon" href="/assets/settlers/favicon/favicon.ico">
    <meta name="msapplication-config" content="./assets/settlers/favicon/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">

    <link rel="stylesheet" type="text/css" href="/assets/settlers/catan.css">
    <link rel="stylesheet" type="text/css" href="/assets/css/hover.min.css">

    <script src="/assets/settlers/js/helper.js"></script>
    <script src="/assets/settlers/js/main.js"></script>
    <script>
      window.onload = function() {
        var search = window.location.search;

        var game;
        var type = 'spiral';

        if (search.startsWith("?")) {
          search = search.slice(1).split("&");
          var searchQuery = {};
          for (var i = 0; i < search.length; i++) {
            var parts = search[i].split("=");
            if (parts.length == 2) {
              searchQuery[parts[0]] = parts[1];
            }
          }
          if (searchQuery['game']) {
            game = decode(searchQuery['game']);
          }
          if (searchQuery['moves']) {
            game.locs = decodeMoves(searchQuery['moves']);
          }
          if (searchQuery['gameType']) {
            type = searchQuery['gameType'];
          }
        }

        if (!game) {
          if (type == 'random') {
            game = newRandomGame();
          } else if (type == 'pseudorandom') {
            game = newPseudoRandomGame();
          } else {
            game = newSpiralGame();
          }
        }

        var gameCode = encode(game);
        displayGame(game);

        document.querySelector('#gameid').href = '?game=' + gameCode;
        document.querySelector('#moveid').href = '?game=' + gameCode + '&moves=' + encodeMoves(game);

        var moveColors = ['Red', 'Blue', 'Yellow', 'White', 'White', 'Yellow', 'Blue', 'Red', 'No one'];
        var index = game.locs.length;

        // Set up clickable spots
        var spots = document.querySelectorAll('.chunk span');

        document.querySelector('#placement').innerHTML = moveColors[index] + ' is placing.';
        if (index == moveColors.length - 1) {
          for (var i = 0; i < spots.length; i++) {
            spots[i].classList.remove('open');
          }
        }

        // Undo button
        document.querySelector('#undo').addEventListener('click', function(event) {
          if (game.locs.length > 0) {
            // Pop off a move
            var removed = game.locs.pop();

            // Update the move URL
            document.querySelector('#moveid').href = '?game=' + gameCode + '&moves=' + encodeMoves(game);

            // Update the index
            index -= 1;
            document.querySelector('#placement').innerHTML = moves[index] + ' is placing.';

            // Update the spot
            var spot = document.querySelector('.chunk span[data-num="' + removed + '"]');
            spot.className = '';

            // Make sure open spots are marked as open
            for (var i = 0; i < spots.length; i++) {
              if (spots[i].className == '') {
                spots[i].classList.add('open');
              }
            }
          }
        });

        for (var i = 0; i < spots.length; i++) {
          spots[i].addEventListener('click', function(event) {
            if (index < moveColors.length - 1) {
              if (this.classList.contains('open')) {
                // Set it to whatever spot it is now
                this.classList.remove('open');
                this.classList.add(moveColors[index].toLowerCase());
                if (index < 4) {
                  this.classList.add('first');
                }

                // Add it to the list
                game.locs.push(parseInt(this.dataset.num));
                document.querySelector('#moveid').href = '?game=' + gameCode + '&moves=' + encodeMoves(game);

                // Increment who you're playing for
                index += 1;
                document.querySelector('#placement').innerHTML = moveColors[index] + ' is placing.';
              }

              if (index == moveColors.length - 1) {
                for (var i = 0; i < spots.length; i++) {
                  spots[i].classList.remove('open');
                }
              }
            }
          });
        }
      };
    </script>
  </head>
  <body>
  </body>
</html>